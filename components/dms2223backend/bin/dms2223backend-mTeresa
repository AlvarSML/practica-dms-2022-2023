#!/usr/bin/env python3

from dms2223backend.data.config import BackendConfiguration
from dms2223backend.data.db import Base, Schema
from dms2223backend.data.db import Usuario, Pregunta, Reporte, Respuesta, Comentario, Voto, Feedback

from sqlalchemy.orm.session import Session  # type: ignore
from sqlalchemy import select, Table, Column, Integer, String, MetaData # type: ignore

from datetime import datetime

cfg: BackendConfiguration = BackendConfiguration()
cfg.load_from_file(cfg.default_config_file())
db: Schema = Schema(base=Base,config=cfg)

db.clear_database(cfg)
session:Session = db.new_session()


usuario1 = Usuario(1,"María")
usuario2 = Usuario(2,"Álvar")
session.add(usuario1) #Guardamos datos
session.add(usuario2)
session.commit() #Commit

voto1 = Voto(1,1,1,positivo)
voto2 = Voto(2,2,1,negativo)
session.add(voto1) 
session.add(voto2)
session.commit()

reporte1 = Reporte(1,1,2,3, "No es correcto","No está de acuerdo","Se rechaza",rechazado)
reporte2 = Reporte(2,1,2,4, "Es correcto","De acuerdo","Se acepta", aceptado)
session.add(reporte1) 
session.add(reporte2)
session.commit()

feedback1 = Feedback(1, verde, "Feedback de ejemplo 1" )
feedback2 = Feedback(2,rojo, "Feedback de ejemplo 2" )
session.add(feedback1) 
session.add(feedback2)
session.commit()

pregunta1 = Pregunta(5,"Titulo1")
pregunta2 = Pregunta(6,"Titulo2")
session.add(pregunta1) 
session.add(pregunta2)
session.commit()

respuesta1 = Respuesta(1,5)
respuesta2 = Respuesta(1,6)
session.add(respuesta1) 
session.add(respuesta2)
session.commit()

comentario1 = Comentario(1,1,2)
comentario2 = Comentario(2,1,1)
session.add(comentario1) 
session.add(comentario2)
session.commit()

session.commit()
session.close() #Cerramos la sesión

def print_tabla(tabla):
    stmt = select('*').select_from(tabla)
    result = session.execute(stmt).fetchall()

    print("tabla: "+tabla.__tablename__)
    for p in result:
        print(p)

print_tabla(Pregunta)
print_tabla(Usuario)
print_tabla(Respuesta)



